
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÿÆÿØŸÖÿ© ÿßŸÑŸÅÿ≠ÿµ ÿßŸÑŸÅŸÜŸä ÿßŸÑÿØŸàÿ±Ÿä | ŸÖÿ±ŸÉÿ≤ ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑŸÖÿ±ŸÉÿ®ÿßÿ™</title>

  <!-- Meta -->
  <meta name="description" content="ÿßÿ≠ÿ¨ÿ≤ ŸÖŸàÿπÿØŸÉ ŸÑŸÅÿ≠ÿµ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ© ŸÅŸä ŸÖÿ±ÿßŸÉÿ≤ ÿ≥ŸÑÿßŸÖÿ©. ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ŸàÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑŸÉ." />
  <meta property="og:title" content="ÿÆÿØŸÖÿ© ÿßŸÑŸÅÿ≠ÿµ ÿßŸÑŸÅŸÜŸä ÿßŸÑÿØŸàÿ±Ÿä | ŸÖÿ±ŸÉÿ≤ ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑŸÖÿ±ŸÉÿ®ÿßÿ™" />
  <meta property="og:description" content="ÿßÿ≠ÿ¨ÿ≤ ŸÖŸàÿπÿØŸÉ ŸÑŸÅÿ≠ÿµ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ© ÿ®ÿ≥ŸáŸàŸÑÿ© Ÿàÿ≥ÿ±ÿπÿ©" />
  <meta name="theme-color" content="#0ea5a5" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome (ŸÑŸÑÿ£ŸäŸÇŸàŸÜÿßÿ™ ŸÖÿ´ŸÑ fas fa-home) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

  <style>
    :root{--primary:#0ea5a5;--primary-600:#0c8e8e;--ink:#0f172a;--muted:#64748b;--line:#e5e7eb;--bg:#ffffff;--soft:#f8fafc;--radius:16px;--success:#10b981;--error:#ef4444;}
    *{box-sizing:border-box} html,body{margin:0}
    body{font-family:"Cairo",system-ui,sans-serif;line-height:1.65;color:var(--ink);background:var(--bg);scroll-behavior:smooth}
    a{text-decoration:none;color:inherit} img{max-width:100%;display:block}
    .container{width:min(1400px,100% - 16px);margin-inline:auto}

    /* Header */
    .booking-header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);box-shadow:0 2px 20px rgba(0,0,0,.05)}
    .header-content{display:flex;align-items:center;justify-content:flex-start;height:80px;padding:0 1rem}
    .logo-section{display:flex;align-items:center}
    .logo-link{display:flex;align-items:center;gap:1rem;text-decoration:none;color:var(--ink);transition:transform .3s ease}
    .logo-link:hover{transform:scale(1.02)}
    .logo-img{height:48px;width:auto;transition:transform .3s ease}
    .logo-link:hover .logo-img{transform:scale(1.05)}
    .logo-text{display:flex;flex-direction:column;gap:.1rem}
    .brand-name{font-size:1.5rem;font-weight:900;color:var(--primary);line-height:1}
    .service-name{font-size:.85rem;color:var(--muted);font-weight:600;line-height:1}
    .header-actions{display:flex;align-items:center;gap:1.5rem}
    @media (max-width: 768px) {
      .header-content{flex-direction:column;height:auto;padding:1rem;gap:1rem}
      .logo-text{text-align:center}
      .header-actions{width:100%;justify-content:center}
    }

    /* Title */
    .title .lin-1{color:var(--muted);margin:0}
    .title .lin-2{font-size:2rem;font-weight:900;margin:0}
    .title .lin-2 span{color:var(--primary)}
    .title .lin-3{color:var(--ink);font-weight:700}

    /* Card/Form */
    .booking-form{max-width:820px;margin:1rem auto 0;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:2rem;box-shadow:0 8px 32px rgba(0,0,0,.06)}
    .section-title{font-size:1.2rem;font-weight:800;margin:1.2rem 0 .8rem;color:var(--ink);display:flex;gap:.5rem;align-items:center}
    .btn-full{width:100%}

    /* Alerts */
    .alert-error{background:#fff5f5;border:1px solid #fecaca;color:#b91c1c}
    .validation-feedback{font-size:.85rem;margin-top:.25rem;min-height:1.2rem;display:block}
    .form-control.error{border-color:var(--error);box-shadow:0 0 0 0.2rem rgba(239, 68, 68, 0.25)}
    .form-control.valid{border-color:var(--success);box-shadow:0 0 0 0.2rem rgba(16, 185, 129, 0.25)}
    .text-danger{color:var(--error) !important}
    .text-success{color:var(--success) !important}
    
    /* ÿ•ÿÆŸÅÿßÿ° ÿπŸÜÿµÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ */
    .connection-status{display:none !important;visibility:hidden !important}

    /* Footer */
    footer{background:linear-gradient(135deg,#0f172a,#1e293b);color:#fff;padding:2rem 1rem;text-align:center;margin-top:2rem}
    footer::before{content:'';display:block;height:4px;background:linear-gradient(90deg,var(--primary),var(--primary-600));margin:-2rem 0 1.5rem}

    /* Progress bar */
    .top-progress{position:fixed;top:0;left:0;height:3px;background:linear-gradient(90deg,var(--primary),var(--primary-600));width:0;z-index:9999;transition:width .3s ease}

    /* Plate Number Input */
    .plate-input-container{display:flex;gap:1.5rem;align-items:center;background:linear-gradient(135deg,var(--soft),#f1f5f9);border:2px solid var(--line);border-radius:16px;padding:1.5rem;box-shadow:0 4px 12px rgba(0,0,0,.05)}
    .plate-visual{flex-shrink:0;position:relative}
    .plate-display{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;background:linear-gradient(145deg,#ffffff,#f8fafc);border:4px solid #2c5530;border-radius:16px;padding:16px;width:160px;height:80px;box-shadow:0 8px 25px rgba(0,0,0,.2),inset 0 2px 4px rgba(255,255,255,.8);position:relative;transform:perspective(1000px) rotateX(5deg)}
    .plate-display::before{content:'ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©';position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#2c5530,#1e3a21);color:#fff;padding:4px 12px;border-radius:8px;font-size:0.65rem;font-weight:700;letter-spacing:0.5px;box-shadow:0 2px 6px rgba(0,0,0,.3)}
    .plate-display::after{content:'üá∏üá¶';position:absolute;bottom:-8px;right:8px;font-size:1.2rem;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}
    .plate-section{display:flex;align-items:center;justify-content:center;background:linear-gradient(145deg,#ffffff,#f1f5f9);border:2px solid #e2e8f0;border-radius:8px;font-weight:900;font-size:1.3rem;color:#1a202c;min-height:48px;transition:all .4s cubic-bezier(0.4,0,0.2,1);box-shadow:0 3px 6px rgba(0,0,0,.1),inset 0 1px 2px rgba(255,255,255,.9)}
    .plate-section:not(:last-child){background:linear-gradient(145deg,#ffffff,#f8fafc);color:#2d3748;border-color:#cbd5e1}
    .plate-section:last-child{background:linear-gradient(145deg,#2c5530,#1e3a21);color:#fff;border-color:#2c5530;box-shadow:0 4px 12px rgba(44,85,48,.4),inset 0 1px 2px rgba(255,255,255,.2)}
    .plate-section.filled{transform:scale(1.08) translateY(-2px);box-shadow:0 6px 15px rgba(0,0,0,.25),inset 0 1px 3px rgba(255,255,255,.9)}
    .plate-section:last-child.filled{box-shadow:0 8px 20px rgba(44,85,48,.5),inset 0 1px 3px rgba(255,255,255,.3)}
    .plate-inputs{display:flex;gap:1rem;flex:1;align-items:flex-end;flex-wrap:wrap}
    .plate-letters-group,.plate-numbers-group{display:flex;flex-direction:column;gap:.3rem;flex:1;min-width:100px}
    .plate-input-label{font-size:.8rem;font-weight:600;color:#2c5530;text-align:center;margin:0;padding:0 .5rem;background:linear-gradient(135deg,rgba(44,85,48,.1),rgba(44,85,48,.05));border-radius:6px;border:1px solid rgba(44,85,48,.2);box-shadow:0 1px 3px rgba(44,85,48,.1)}
    .plate-select{flex:1;min-width:70px;text-align:center;font-weight:700;border:2px solid #2c5530;border-radius:10px;padding:.6rem;background:linear-gradient(145deg,#ffffff,#f8fafc);transition:all .4s cubic-bezier(0.4,0,0.2,1);box-shadow:0 3px 8px rgba(44,85,48,.1),inset 0 1px 2px rgba(255,255,255,.9)}
    .plate-select:focus{border-color:#1e3a21;box-shadow:0 0 0 4px rgba(44,85,48,.15),0 4px 12px rgba(44,85,48,.2);outline:none;transform:translateY(-2px)}
    .plate-select:hover{border-color:#1e3a21;transform:translateY(-1px);box-shadow:0 4px 10px rgba(44,85,48,.15)}
    .plate-numbers{flex:1.5;min-width:120px;text-align:center;font-weight:700;font-size:1.3rem;border:2px solid #2c5530;border-radius:10px;padding:.6rem;background:linear-gradient(145deg,#ffffff,#f8fafc);transition:all .4s cubic-bezier(0.4,0,0.2,1);box-shadow:0 3px 8px rgba(44,85,48,.1),inset 0 1px 2px rgba(255,255,255,.9)}
    .plate-numbers:focus{border-color:#1e3a21;box-shadow:0 0 0 4px rgba(44,85,48,.15),0 4px 12px rgba(44,85,48,.2);outline:none;transform:translateY(-2px)}
    .plate-numbers:hover{border-color:#1e3a21;transform:translateY(-1px);box-shadow:0 4px 10px rgba(44,85,48,.15)}
    .plate-numbers::placeholder{color:#718096;font-size:1.1rem;font-weight:600}
    
    /* Plate label */
    .plate-label{position:absolute;top:-12px;right:12px;background:linear-gradient(135deg,#2c5530,#1e3a21);color:#fff;padding:.4rem .8rem;border-radius:8px;font-size:.75rem;font-weight:800;letter-spacing:.8px;box-shadow:0 4px 8px rgba(44,85,48,.4);border:1px solid rgba(255,255,255,.2)}
    
    /* Plate animations */
    @keyframes plateGlow {
      0%, 100% { box-shadow: 0 8px 25px rgba(0,0,0,.2),inset 0 2px 4px rgba(255,255,255,.8); }
      50% { box-shadow: 0 12px 35px rgba(44,85,48,.3),inset 0 2px 4px rgba(255,255,255,.9); }
    }
    
    .plate-display:hover {
      animation: plateGlow 2.5s ease-in-out infinite;
      transform: perspective(1000px) rotateX(5deg) scale(1.02);
    }
    
    /* Plate section pulse animation */
    @keyframes platePulse {
      0% { transform: scale(1) translateY(0); }
      50% { transform: scale(1.08) translateY(-3px); }
      100% { transform: scale(1.08) translateY(-2px); }
    }
    
    .plate-section.filled {
      animation: platePulse 0.4s cubic-bezier(0.4,0,0.2,1);
    }
    
    /* New shine effect */
    @keyframes plateShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .plate-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.4), transparent);
      animation: plateShine 3s ease-in-out infinite;
      pointer-events: none;
      z-index: 1;
    }
    
    /* Saudi Plate Design */
     .saudi-plate{ 
       display:grid; 
       grid-template-columns: 46px 1fr; 
       background:#fff; 
       border:4px solid #111; 
       border-radius:16px; 
       box-shadow:0 8px 25px rgba(0,0,0,.2), inset 0 2px 4px rgba(255,255,255,.8); 
       width: min(520px, 100%); 
       min-height: 120px; 
       position:relative; 
     } 
     
     .plate-band{ 
       background: linear-gradient(180deg,#0a6,#078); 
       color:#fff; 
       display:flex; 
       flex-direction:column; 
       justify-content:center; 
       align-items:center; 
       gap:6px; 
       border-inline-end:4px solid #111; 
       border-top-left-radius:12px; 
       border-bottom-left-radius:12px; 
     } 
     .band-ksa{ font-weight:900; letter-spacing:1px; } 
     .band-icon{ font-size:18px; line-height:1; filter:drop-shadow(0 1px 1px rgba(0,0,0,.3)); } 
     
     .plate-cells{ 
       display:grid; 
       grid-template-columns: repeat(4, 1fr) 8px repeat(3, 1fr); 
       gap:6px; 
       padding:12px; 
     } 
     .divider{ background:#111; border-radius:2px; } 
     
     .cell{ 
       border:2px solid #111; 
       border-radius:10px; 
       background: linear-gradient(145deg,#ffffff,#f8fafc); 
       display:flex; flex-direction:column; justify-content:center; align-items:center; 
       padding:6px 0; 
       min-height: 72px; 
     } 
     .cell .ar{ font-size:28px; font-weight:900; color:#111; line-height:1; } 
     .cell .en{ font-size:16px; font-weight:800; color:#1f2937; line-height:1; margin-top:6px; opacity:.95; } 
     
     .cell.filled{ box-shadow:0 6px 15px rgba(0,0,0,.18), inset 0 1px 2px rgba(255,255,255,.9); transform: translateY(-1px); transition:.2s; }
    
    /* Plate guide */
    .plate-guide{display:flex;justify-content:space-between;margin-top:.5rem;padding:0 .5rem}
    .guide-item{font-size:.7rem;color:#718096;font-weight:500;text-align:center;opacity:.8;transition:opacity .3s ease}
    .plate-visual:hover .guide-item{opacity:1;color:#2c5530}
    
    /* ŸÑŸÖÿπÿßŸÜ ÿÆŸÅŸäŸÅ ÿØŸàŸÜ ÿ™ÿπÿßÿ±ÿ∂ ŸÖÿπ ÿ£Ÿä ::after ÿ¢ÿÆÿ± */ 
     .saudi-plate::before{ 
       content:''; 
       position:absolute; inset:0; 
       background:linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent); 
       transform: translateX(-100%); 
       animation: shine 3.2s ease-in-out infinite; 
       pointer-events:none; border-radius:12px; 
     } 
     @keyframes shine{ 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }

     /* ŸÖÿØÿÆŸÑ ŸÑŸàÿ≠ÿ© ÿ®ÿ≥Ÿäÿ∑ inline ÿ®ŸÑÿß ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ */ 
     .plate-inline { gap:.5rem; } 
     .plate-inline .form-select { min-width:90px; } 
     .plate-inline .form-control { max-width:150px; } 

     @media (max-width: 576px){ 
       .plate-inline { flex-wrap: wrap; } 
       .plate-inline .form-select, 
       .plate-inline .form-control { flex:1 1 30%; min-width:120px; } 
     }
    
    @media (max-width: 768px){ 
       .plate-input-container{flex-direction:column;gap:1.5rem;padding:1.2rem}
       .plate-visual{margin-bottom:1.5rem}
       .saudi-plate{ min-height:100px; } 
       .cell{ min-height:64px; } 
       .cell .ar{ font-size:24px; } 
       .cell .en{ font-size:14px; } 
       .plate-inputs{width:100%;flex-direction:column;gap:1rem;align-items:stretch}
       .plate-letters-group,.plate-numbers-group{min-width:100%;max-width:100%}
       .plate-select,.plate-numbers{width:100%;min-width:auto;font-size:1.1rem;padding:.8rem}
       .plate-input-label{font-size:.9rem;padding:.3rem .6rem}
       .plate-guide{padding:0 1rem}
       .guide-item{font-size:.75rem}
     }

        /* ÿ¥ŸÉŸÑ ÿßŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ© ÿ®ÿµŸÅŸäŸÜ */
        .ksa-plate-flat {
            display: grid;
            grid-template-columns: 1fr 48px;
            max-width: 560px;
            background: #fff;
            border: 4px solid #111;
            border-radius: 14px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .ksa-plate-cells {
            display: grid;
            grid-auto-rows: minmax(60px, 1fr);
        }
        
        .ksa-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
        }
        
        .ksa-en {
            border-top: 2px solid #111;
        }
        
        .ksa-row .ksa-letters {
            border-inline-start: 2px solid #111;
        }
        
        .ksa-nums, .ksa-letters {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 10px;
            font-family: "Cairo", system-ui, sans-serif;
            font-weight: 900;
            color: #111;
        }
        
        .ksa-ar .ksa-nums, .ksa-ar .ksa-letters {
            font-size: 26px;
        }
        
        .ksa-en .ksa-nums, .ksa-en .ksa-letters {
            font-size: 22px;
            letter-spacing: 2px;
        }
        
        .ksa-band {
            background: #0a6ca8;
            color: #fff;
            border-left: 4px solid #111;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: 900;
            font-size: 12px;
            letter-spacing: 1px;
        }
        
        @media (max-width: 576px) {
            .ksa-plate-flat {
                max-width: 100%;
            }
            
            .ksa-ar .ksa-nums, .ksa-ar .ksa-letters {
                font-size: 22px;
            }
            
            .ksa-en .ksa-nums, .ksa-en .ksa-letters {
                font-size: 18px;
            }
        } 
  </style>
</head>
<body>

<!-- Header -->
<nav class="booking-header">
  <div class="container">
    <div class="header-content">
      <div class="logo-section">
        <a href="index.php" class="logo-link">
          <img src="https://i.postimg.cc/ZKC5781D/2025-07-04-082630.png" class="logo-img" alt="ÿ¥ÿπÿßÿ± ÿ≥ŸÑÿßŸÖÿ©">
        </a>
      </div>
    </div>
  </div>
</nav>

<!-- Menu -->
<section class="MenuSec">
  <div class="menu-nav container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light rounded">
      <div class="container-fluid">
        <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
          <ul class="navbar-nav gap-2">
            <li class="nav-item"><a class="nav-link" href="index.php"><i class="fas fa-home"></i> ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a></li>
            <li class="nav-item"><a class="nav-link" href="#">ÿ®ŸÜŸàÿØ ÿßŸÑŸÅÿ≠ÿµ ÿßŸÑŸÅŸÜŸä ÿßŸÑÿØŸàÿ±Ÿä</a></li>
            <li class="nav-item"><a class="nav-link active fw-bold" href="booking.php">ÿ≠ÿ¨ÿ≤ ŸÖŸàÿπÿØ</a></li>
            <li class="nav-item"><a class="nav-link" href="booking-summary.php">ŸÖŸÑÿÆÿµ ÿßŸÑÿ≠ÿ¨ÿ≤</a></li>
            <li class="nav-item"><a class="nav-link" href="#">ÿ™ÿπÿØŸäŸÑ ŸÖŸàÿπÿØ</a></li>
            <li class="nav-item"><a class="nav-link" href="#">ÿ•ŸÑÿ∫ÿßÿ° ŸÖŸàÿπÿØ</a></li>
            <li class="nav-item"><a class="nav-link" href="#">ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ≠ÿµ</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
</section>

<!-- Title -->
<section class="title new-date pt-3">
  <div class="container">
    <p class="lin-1">ÿÆÿØŸÖÿ© ÿßŸÑŸÅÿ≠ÿµ</p>
    <p class="lin-2"><span>ÿßŸÑŸÅŸÜŸä</span> ÿßŸÑÿØŸàÿ±Ÿä</p>
    <p class="lin-3 pt-2">ÿ≠ÿ¨ÿ≤ ŸÖŸàÿπÿØ</p>
  </div>
</section>

<!-- Main -->
<main>
  <div class="container">

    <?php if (isset($_SESSION['booking_errors'])): ?>
    <div class="alert alert-danger p-4 rounded" style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; margin-bottom: 2rem;">
      <h6 class="fw-bold mb-3">Ÿäÿ±ÿ¨Ÿâ ÿ™ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿ™ÿßŸÑŸäÿ©:</h6>
      <div class="m-0">
        <?php foreach ($_SESSION['booking_errors'] as $error): ?>
          <div class="mb-2"><?= $error ?></div>
        <?php endforeach; ?>
      </div>
      <div class="mt-3">
        <a href="?debug=1" class="btn btn-outline-danger btn-sm" style="color: #721c24; border-color: #721c24;">
          <i class="fas fa-bug me-1"></i> ŸÑŸÑÿ™ÿ¥ÿÆŸäÿµ: ÿßÿ∂ÿ∫ÿ∑ ŸáŸÜÿß ŸÑÿ±ÿ§Ÿäÿ© ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿÆÿ∑ÿ£
        </a>
      </div>
    </div>
    <?php unset($_SESSION['booking_errors']); ?>
    <?php endif; ?>

    <?php if (isset($_GET['debug']) && $_GET['debug'] == '1'): ?>
      <div style="background:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;padding:1rem;margin:1rem 0;font-family:monospace;font-size:0.9rem">
        <h6 style="color:#495057;margin-bottom:0.5rem">ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ¥ÿÆŸäÿµ:</h6>
        <p><strong>ÿ≠ÿßŸÑÿ© ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:</strong> 
          <?php 
          try {
            require_once 'db.php';
            echo isset($pdo) ? '‚úÖ ŸÖÿ™ÿµŸÑÿ©' : '‚ùå ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑÿ©';
          } catch (Exception $e) {
            echo '‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ: ' . htmlspecialchars($e->getMessage());
          }
          ?>
        </p>
        <p><strong>ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©:</strong></p>
        <pre style="margin:0;white-space:pre-wrap;word-wrap:break-word"><?= htmlspecialchars(print_r($_SESSION, true)) ?></pre>
        <p><strong>ÿ®ŸäÿßŸÜÿßÿ™ POST:</strong></p>
        <pre style="margin:0;white-space:pre-wrap;word-wrap:break-word"><?= htmlspecialchars(print_r($_POST, true)) ?></pre>
      </div>
    <?php endif; ?>

    <div class="booking-form">
      <h5 class="section-title">ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©</h5>

      <form id="bookingForm" method="post" action="process-booking.php" novalidate>
        <input type="hidden" name="csrf_token" value="<?= htmlspecialchars($_SESSION['csrf'] ?? '') ?>">

        <div class="row">
          <div class="mb-3 col-md-6">
            <label for="first_name" class="form-label">ÿßŸÑÿßÿ≥ŸÖ<sub>*</sub></label>
            <input type="text" class="form-control" id="first_name" name="first_name" placeholder="ÿßÿØÿÆŸÑ ÿßŸÑÿßÿ≥ŸÖ" value="<?= htmlspecialchars($_SESSION['booking_data']['first_name'] ?? '') ?>" required>
            <div class="validation-feedback text-danger"></div>
          </div>
          <div class="mb-3 col-md-6">
            <label for="national_id" class="form-label">ÿ±ŸÇŸÖ ÿßŸÑŸáŸàŸäÿ© / ÿßŸÑÿ•ŸÇÿßŸÖÿ©<sub>*</sub></label>
            <input type="text" class="form-control" id="national_id" name="national_id" placeholder="10 ÿ£ÿ±ŸÇÿßŸÖ" value="<?= htmlspecialchars($_SESSION['booking_data']['national_id'] ?? '') ?>" required>
            <div class="validation-feedback text-danger"></div>
          </div>
        </div>

        <div class="mb-3">
          <label for="phone" class="form-label d-block">ÿ±ŸÇŸÖ ÿßŸÑÿ¨ŸàÿßŸÑ<sub>*</sub></label>
          <div class="input-group">
            <input type="text" class="form-control text-start" id="phone" name="phone" placeholder="05xxxxxxxx" value="<?= htmlspecialchars($_SESSION['booking_data']['phone'] ?? '') ?>" required>
            <select id="SelectCountryCode" class="form-select" style="max-width:110px">
              <option value="966" selected>966</option>
              <option value="964">964</option>
              <option value="961">961</option>
            </select>
          </div>
          <div class="validation-feedback text-danger"></div>
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
          <input type="email" class="form-control text-start" id="email" name="email" placeholder="email@example.com" value="<?= htmlspecialchars($_SESSION['booking_data']['email'] ?? '') ?>">
          <div class="validation-feedback text-danger"></div>
        </div>

        <!-- Vehicle Info -->
        <h5 class="section-title">ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©</h5>

        <div class="row">
          <div class="mb-3 col-md-6">
            <label for="vehicle_type" class="form-label">ŸÜŸàÿπ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©<sub>*</sub></label>
            <select id="vehicle_type" name="vehicle_type" class="form-control" required>
              <option value="">ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©</option>
              <option value="private"     <?= (($_SESSION['booking_data']['vehicle_type'] ?? '')==='private'?'selected':'') ?>>üöó ŸÖÿ±ŸÉÿ®ÿ© ÿÆÿßÿµÿ©</option>
              <option value="light_bus"   <?= (($_SESSION['booking_data']['vehicle_type'] ?? '')==='light_bus'?'selected':'') ?>>üöê ÿ≠ÿßŸÅŸÑÿ© ÿµÿ∫Ÿäÿ±ÿ©</option>
              <option value="light_truck" <?= (($_SESSION['booking_data']['vehicle_type'] ?? '')==='light_truck'?'selected':'') ?>>üöö ŸÜŸÇŸÑ ÿÆŸÅŸäŸÅ</option>
              <option value="heavy_truck" <?= (($_SESSION['booking_data']['vehicle_type'] ?? '')==='heavy_truck'?'selected':'') ?>>üöõ ŸÜŸÇŸÑ ÿ´ŸÇŸäŸÑ</option>
              <option value="motorcycle"  <?= (($_SESSION['booking_data']['vehicle_type'] ?? '')==='motorcycle'?'selected':'') ?>>üèçÔ∏è ÿØÿ±ÿßÿ¨ÿ© ŸÜÿßÿ±Ÿäÿ©</option>
              <option value="van"         <?= (($_SESSION['booking_data']['vehicle_type'] ?? '')==='van'?'selected':'') ?>>üöê ŸÅÿßŸÜ</option>
              <option value="pickup"      <?= (($_SESSION['booking_data']['vehicle_type'] ?? '')==='pickup'?'selected':'') ?>>üõª ÿ®ŸäŸÉ ÿ£ÿ®</option>
            </select>
            <div class="validation-feedback text-danger"></div>
          </div>
          <div class="mb-3 col-md-6">
            <label for="vehicle_make" class="form-label">ÿ®ŸÑÿØ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ<sub>*</sub></label>
            <select class="form-control" id="vehicle_make" name="vehicle_make" required>
              <option value="">ÿßÿÆÿ™ÿ± ÿ®ŸÑÿØ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ</option>
              <option value="ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©'?'selected':'') ?>>üá∏üá¶ ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©</option>
              <option value="ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™'?'selected':'') ?>>üá¶üá™ ÿØŸàŸÑÿ© ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÖÿ™ÿ≠ÿØÿ©</option>
              <option value="ÿßŸÑŸÉŸàŸäÿ™" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿßŸÑŸÉŸàŸäÿ™'?'selected':'') ?>>üá∞üáº ÿØŸàŸÑÿ© ÿßŸÑŸÉŸàŸäÿ™</option>
              <option value="ŸÇÿ∑ÿ±" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ŸÇÿ∑ÿ±'?'selected':'') ?>>üá∂üá¶ ÿØŸàŸÑÿ© ŸÇÿ∑ÿ±</option>
              <option value="ÿßŸÑÿ®ÿ≠ÿ±ŸäŸÜ" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿßŸÑÿ®ÿ≠ÿ±ŸäŸÜ'?'selected':'') ?>>üáßüá≠ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ≠ÿ±ŸäŸÜ</option>
              <option value="ÿπŸÖÿßŸÜ" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿπŸÖÿßŸÜ'?'selected':'') ?>>üá¥üá≤ ÿ≥ŸÑÿ∑ŸÜÿ© ÿπŸÖÿßŸÜ</option>
              <option value="ÿßŸÑÿ£ÿ±ÿØŸÜ" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿßŸÑÿ£ÿ±ÿØŸÜ'?'selected':'') ?>>üáØüá¥ ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ÿØŸÜŸäÿ© ÿßŸÑŸáÿßÿ¥ŸÖŸäÿ©</option>
              <option value="ŸÑÿ®ŸÜÿßŸÜ" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ŸÑÿ®ŸÜÿßŸÜ'?'selected':'') ?>>üá±üáß ÿßŸÑÿ¨ŸÖŸáŸàÿ±Ÿäÿ© ÿßŸÑŸÑÿ®ŸÜÿßŸÜŸäÿ©</option>
              <option value="ÿßŸÑÿπÿ±ÿßŸÇ" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿßŸÑÿπÿ±ÿßŸÇ'?'selected':'') ?>>üáÆüá∂ ÿ¨ŸÖŸáŸàÿ±Ÿäÿ© ÿßŸÑÿπÿ±ÿßŸÇ</option>
              <option value="ŸÖÿµÿ±" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ŸÖÿµÿ±'?'selected':'') ?>>üá™üá¨ ÿ¨ŸÖŸáŸàÿ±Ÿäÿ© ŸÖÿµÿ± ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
              <option value="ÿ£ÿÆÿ±Ÿâ" <?= (($_SESSION['booking_data']['vehicle_make'] ?? '')==='ÿ£ÿÆÿ±Ÿâ'?'selected':'') ?>>üåç ÿØŸàŸÑÿ© ÿ£ÿÆÿ±Ÿâ</option>
            </select>
            <div class="validation-feedback text-danger"></div>
          </div>
        </div>

        <div class="row">
          <div class="mb-3 col-md-6">
            <div class="mb-3"> 
              <label for="plate_numbers" class="form-label">ÿ±ŸÇŸÖ ÿßŸÑŸÑŸàÿ≠ÿ©<sub>*</sub></label> 

              <div class="input-group plate-inline"> 
                <!-- ÿßŸÑÿ≠ÿ±ŸàŸÅ: ÿ´ŸÑÿßÿ´ÿ© ÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ ŸÅŸä ÿ≥ÿ∑ÿ± Ÿàÿßÿ≠ÿØ --> 
                <select class="form-select text-center" id="plate_letter1" name="plate_letter1" aria-label="ÿßŸÑÿ≠ÿ±ŸÅ ÿßŸÑÿ£ŸàŸÑ"> 
                  <option value="">ÿ≠ÿ±ŸÅ 1</option> 
                  <!-- ÿ≥ŸäŸèÿπÿßÿØ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑŸÄ JS ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠ÿ© ŸÅŸÇÿ∑ --> 
                </select> 

                <select class="form-select text-center" id="plate_letter2" name="plate_letter2" aria-label="ÿßŸÑÿ≠ÿ±ŸÅ ÿßŸÑÿ´ÿßŸÜŸä"> 
                  <option value="">ÿ≠ÿ±ŸÅ 2</option> 
                </select> 

                <select class="form-select text-center" id="plate_letter3" name="plate_letter3" aria-label="ÿßŸÑÿ≠ÿ±ŸÅ ÿßŸÑÿ´ÿßŸÑÿ´"> 
                  <option value="">ÿ≠ÿ±ŸÅ 3</option> 
                </select> 

                <!-- ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ: 1‚Äì4 --> 
                <input type="text" class="form-control text-center" id="plate_numbers" name="plate_numbers" 
                       placeholder="ÿ£ÿ±ŸÇÿßŸÖ (1‚Äì4)" maxlength="4" inputmode="numeric" pattern="[0-9Ÿ†-Ÿ©]{1,4}" value="<?= htmlspecialchars($_SESSION['booking_data']['plate_numbers'] ?? '') ?>"> 
              </div> 

              <!-- ŸÇŸäŸÖ ÿÆŸÅŸäÿ©: ÿßŸÑŸÜÿµ ÿßŸÑŸÖŸÇÿ±Ÿàÿ° + ŸÜÿ≥ÿÆÿ© ŸÖÿπŸäÿßÿ±Ÿäÿ© 3 ÿ£ÿ≠ÿ±ŸÅ + 4 ÿ£ÿ±ŸÇÿßŸÖ --> 
              <input type="hidden" id="plate_number" name="plate_number" value="<?= htmlspecialchars($_SESSION['booking_data']['plate_number'] ?? '') ?>"> 
              <input type="hidden" id="plate_number_norm" name="plate_number_norm" value="<?= htmlspecialchars($_SESSION['booking_data']['plate_number_norm'] ?? '') ?>"> 

              <div class="validation-feedback text-danger"></div> 
              
              <!-- ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ≥ÿπŸàÿØŸäÿ© (ÿµŸÅŸäŸÜ) -->
              <div class="ksa-plate-flat" id="ksaPlate">
                <div class="ksa-plate-cells">
                  <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿπŸÑŸàŸä (ÿπÿ±ÿ®Ÿä) -->
                  <div class="ksa-row ksa-ar" dir="rtl">
                    <div class="ksa-nums" id="pvArNums">Ÿ†Ÿ†Ÿ†Ÿ†</div>
                    <div class="ksa-letters" id="pvArLetters">ÿß ÿ® ÿØ</div>
                  </div>
                  <!-- ÿßŸÑÿµŸÅ ÿßŸÑÿ≥ŸÅŸÑŸä (ŸÑÿßÿ™ŸäŸÜŸä) -->
                  <div class="ksa-row ksa-en" dir="ltr">
                    <div class="ksa-nums" id="pvEnNums">0000</div>
                    <div class="ksa-letters" id="pvEnLetters">R X B</div>
                  </div>
                </div>
                <div class="ksa-band" aria-hidden="true"><span>KSA</span></div>
              </div>
            </div>
          </div>
          <div class="mb-3 col-md-6">
            <label for="vehicle_year" class="form-label">ÿ≥ŸÜÿ© ÿßŸÑÿµŸÜÿπ<sub>*</sub></label>
            <select class="form-control" id="vehicle_year" name="vehicle_year" required>
              <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ≥ŸÜÿ©</option>
              <?php for($year = date('Y'); $year >= 1990; $year--): ?>
                <option value="<?= $year ?>" <?= (isset($_SESSION['booking_data']['vehicle_year']) && $_SESSION['booking_data']['vehicle_year'] == $year) ? 'selected' : '' ?>><?= $year ?></option>
              <?php endfor; ?>
            </select>
            <div class="validation-feedback text-danger"></div>
          </div>
        </div>

        <!-- Service Center -->
        <h5 class="section-title">ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿÆÿØŸÖÿ©</h5>

        <div class="row">
          <div class="mb-3 col-md-6">
            <label for="inspection_type" class="form-label">ŸÜŸàÿπ ÿßŸÑŸÅÿ≠ÿµ<sub>*</sub></label>
            <select class="form-control" id="inspection_type" name="inspection_type" required>
              <option value="">ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑŸÅÿ≠ÿµ</option>
              <option value="technical_inspection" <?= (($_SESSION['booking_data']['inspection_type'] ?? '')==='technical_inspection'?'selected':'') ?>>üîß ŸÅÿ≠ÿµ ŸÅŸÜŸä</option>
              <option value="re_inspection" <?= (($_SESSION['booking_data']['inspection_type'] ?? '')==='re_inspection'?'selected':'') ?>>üîÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÅÿ≠ÿµ ÿßŸÑŸÅŸÜŸä</option>
            </select>
            <div class="validation-feedback text-danger"></div>
          </div>
          <div class="mb-3 col-md-6">
            <label for="branch" class="form-label">ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©<sub>*</sub></label>
            <select class="form-control" id="branch" name="branch" required>
              <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©</option>
              <option value="riyadh" <?= (($_SESSION['booking_data']['branch'] ?? '')==='riyadh'?'selected':'') ?>>üèõÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ±Ÿäÿßÿ∂</option>
              <option value="makkah" <?= (($_SESSION['booking_data']['branch'] ?? '')==='makkah'?'selected':'') ?>>üïã ŸÖŸÜÿ∑ŸÇÿ© ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ©</option>
              <option value="madinah" <?= (($_SESSION['booking_data']['branch'] ?? '')==='madinah'?'selected':'') ?>>üïå ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ©</option>
              <option value="eastern" <?= (($_SESSION['booking_data']['branch'] ?? '')==='eastern'?'selected':'') ?>>üè≠ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©</option>
              <option value="asir" <?= (($_SESSION['booking_data']['branch'] ?? '')==='asir'?'selected':'') ?>>üèîÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ÿπÿ≥Ÿäÿ±</option>
              <option value="tabuk" <?= (($_SESSION['booking_data']['branch'] ?? '')==='tabuk'?'selected':'') ?>>üèúÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ÿ™ÿ®ŸàŸÉ</option>
              <option value="hail" <?= (($_SESSION['booking_data']['branch'] ?? '')==='hail'?'selected':'') ?>>üåæ ŸÖŸÜÿ∑ŸÇÿ© ÿ≠ÿßÿ¶ŸÑ</option>
              <option value="northern" <?= (($_SESSION['booking_data']['branch'] ?? '')==='northern'?'selected':'') ?>>üèïÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≠ÿØŸàÿØ ÿßŸÑÿ¥ŸÖÿßŸÑŸäÿ©</option>
              <option value="jazan" <?= (($_SESSION['booking_data']['branch'] ?? '')==='jazan'?'selected':'') ?>>üå¥ ŸÖŸÜÿ∑ŸÇÿ© ÿ¨ÿßÿ≤ÿßŸÜ</option>
              <option value="najran" <?= (($_SESSION['booking_data']['branch'] ?? '')==='najran'?'selected':'') ?>>üèõÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ŸÜÿ¨ÿ±ÿßŸÜ</option>
              <option value="bahah" <?= (($_SESSION['booking_data']['branch'] ?? '')==='bahah'?'selected':'') ?>>üå≤ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ®ÿßÿ≠ÿ©</option>
              <option value="jouf" <?= (($_SESSION['booking_data']['branch'] ?? '')==='jouf'?'selected':'') ?>>üè∫ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ¨ŸàŸÅ</option>
              <option value="qassim" <?= (($_SESSION['booking_data']['branch'] ?? '')==='qassim'?'selected':'') ?>>üåæ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÇÿµŸäŸÖ</option>
            </select>
            <div class="validation-feedback text-danger"></div>
          </div>
          <div class="mb-3 col-md-6">
            <label for="appointment_date" class="form-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸàÿπÿØ<sub>*</sub></label>
            <input type="date" class="form-control" id="appointment_date" name="appointment_date" value="<?= htmlspecialchars($_SESSION['booking_data']['appointment_date'] ?? '') ?>" required>
            <div class="validation-feedback text-danger"></div>
          </div>
        </div>

        <div class="row">
          <div class="mb-3 col-md-6">
            <label for="appointment_time" class="form-label">ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖŸÅÿ∂ŸÑ<sub>*</sub></label>
            <select id="appointment_time" name="appointment_time" class="form-control" required>
              <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸàŸÇÿ™</option>
              <?php
                $times = ['08:00'=>'8:00 ÿµ','09:00'=>'9:00 ÿµ','10:00'=>'10:00 ÿµ','11:00'=>'11:00 ÿµ','14:00'=>'2:00 ŸÖ','15:00'=>'3:00 ŸÖ','16:00'=>'4:00 ŸÖ','17:00'=>'5:00 ŸÖ'];
                $savedTime = $_SESSION['booking_data']['appointment_time'] ?? '';
                foreach ($times as $val=>$label):
              ?>
                <option value="<?= $val ?>" <?= ($savedTime===$val?'selected':'') ?>><?= $label ?></option>
              <?php endforeach; ?>
            </select>
            <div class="validation-feedback text-danger"></div>
          </div>
        </div>

        <button type="submit" class="btn btn-secondary btn-full mt-3">
          <i class="fas fa-arrow-left"></i>
          ŸÖÿ™ÿßÿ®ÿπÿ©
        </button>
      </form>
    </div>
  </div>
</main>

<!-- Footer -->
<footer>
  <p class="m-0">¬© <?php echo date('Y'); ?> ÿ≥ŸÑÿßŸÖÿ©. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
</footer>

<div class="top-progress" id="topProgress"></div>

<!-- Bootstrap Bundle (JS) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Connection Tracker -->
<script>
  // ÿ™ŸÖÿ±Ÿäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸÑÿ™ÿ™ÿ®ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ
  window.bookingId = <?php echo json_encode($_SESSION['booking_id'] ?? 'null'); ?>;
  window.phone = <?php echo json_encode($_POST['phone'] ?? $_SESSION['phone'] ?? 'null'); ?>;
</script>
<script src="js/connection-tracker.js"></script>

<script>
(function(){
  const form = document.getElementById('bookingForm');
  if (!form) return;

  // Elements
  const countryCode = document.getElementById('SelectCountryCode');
  const phoneField  = document.getElementById('phone');
  const emailField  = document.getElementById('email');
  const plateField  = document.getElementById('plate_number');
  const plateLetter1 = document.getElementById('plate_letter1');
  const plateLetter2 = document.getElementById('plate_letter2');
  const plateLetter3 = document.getElementById('plate_letter3');
  const plateNumbers = document.getElementById('plate_numbers');
  const idField     = document.getElementById('national_id');
  const vehicleType = document.getElementById('vehicle_type');
  const branchSel   = document.getElementById('branch');
  const dateField   = document.getElementById('appointment_date');
  const timeField   = document.getElementById('appointment_time');
  const yearField   = document.getElementById('vehicle_year');
  const makeField   = document.getElementById('vehicle_make');
  const inspectionType = document.getElementById('inspection_type');
  const progressBar = document.getElementById('topProgress');

  // Mappings
  const prices = {
    private: '115', light_bus: '115', light_truck: '115',
    heavy_truck: '235.75', motorcycle: '100', van: '180', pickup: '170'
  };
  const vehicleNames = {
    private:'ŸÖÿ±ŸÉÿ®ÿ© ÿÆÿßÿµÿ©', light_bus:'ÿ≠ÿßŸÅŸÑÿ© ÿµÿ∫Ÿäÿ±ÿ©', light_truck:'ŸÜŸÇŸÑ ÿÆŸÅŸäŸÅ',
    heavy_truck:'ŸÜŸÇŸÑ ÿ´ŸÇŸäŸÑ', motorcycle:'ÿØÿ±ÿßÿ¨ÿ© ŸÜÿßÿ±Ÿäÿ©', van:'ŸÅÿßŸÜ', pickup:'ÿ®ŸäŸÉ ÿ£ÿ®'
  };
  const branchNames = {
    riyadh:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ±Ÿäÿßÿ∂', makkah:'ŸÖŸÜÿ∑ŸÇÿ© ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ©', madinah:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ©',
    eastern:'ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©', asir:'ŸÖŸÜÿ∑ŸÇÿ© ÿπÿ≥Ÿäÿ±', tabuk:'ŸÖŸÜÿ∑ŸÇÿ© ÿ™ÿ®ŸàŸÉ',
    hail:'ŸÖŸÜÿ∑ŸÇÿ© ÿ≠ÿßÿ¶ŸÑ', northern:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≠ÿØŸàÿØ ÿßŸÑÿ¥ŸÖÿßŸÑŸäÿ©', jazan:'ŸÖŸÜÿ∑ŸÇÿ© ÿ¨ÿßÿ≤ÿßŸÜ',
    najran:'ŸÖŸÜÿ∑ŸÇÿ© ŸÜÿ¨ÿ±ÿßŸÜ', bahah:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ®ÿßÿ≠ÿ©', jouf:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ¨ŸàŸÅ', qassim:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÇÿµŸäŸÖ'
  };

  // Min date = today
  const todayISO = new Date().toISOString().split('T')[0];
  dateField.setAttribute('min', todayISO);

  // Helpers
  function setFeedback(field, ok, msg){
    const box = field.closest('.mb-3, .form-group, .input-group')?.parentElement?.querySelector('.validation-feedback')
              || field.closest('.mb-3, .form-group')?.querySelector('.validation-feedback')
              || field.parentElement.querySelector('.validation-feedback');
    if (box) { box.textContent = msg || ''; box.classList.toggle('text-danger', !ok); box.classList.toggle('text-success', !!ok); }
    field.classList.toggle('error', !ok);
    field.classList.toggle('valid', !!ok);
  }

  // Show individual field errors from server
  function showFieldErrors() {
    const errors = <?= json_encode($_SESSION['booking_errors'] ?? []) ?>;
    if (errors.length === 0) return;

    // Map error messages to field names
    const fieldErrorMap = {
      'ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ∑ŸÑŸàÿ® (ÿ≠ÿ±ŸÅÿßŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ).': 'first_name',
      'ÿ±ŸÇŸÖ ÿßŸÑŸáŸàŸäÿ©/ÿßŸÑÿ•ŸÇÿßŸÖÿ© Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 10 ÿ£ÿ±ŸÇÿßŸÖ.': 'national_id',
      'ÿ±ŸÇŸÖ ÿßŸÑÿ¨ŸàÿßŸÑ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠.': 'phone',
      'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠.': 'email',
      'ŸÜŸàÿπ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ© ŸÖÿ∑ŸÑŸàÿ®.': 'vehicle_type',
      'ÿ®ŸÑÿØ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ∑ŸÑŸàÿ®.': 'vehicle_make',
      'ÿ±ŸÇŸÖ ÿßŸÑŸÑŸàÿ≠ÿ© ŸÖÿ∑ŸÑŸàÿ®.': 'plate_number',
      'ÿ≥ŸÜÿ© ÿßŸÑŸÖÿ±ŸÉÿ®ÿ© ŸÖÿ∑ŸÑŸàÿ®ÿ©.': 'vehicle_year',
      'ŸÜŸàÿπ ÿßŸÑŸÅÿ≠ÿµ ŸÖÿ∑ŸÑŸàÿ®.': 'inspection_type',
      'ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ŸÖÿ∑ŸÑŸàÿ®ÿ©.': 'branch',
      'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸàÿπÿØ ŸÖÿ∑ŸÑŸàÿ®.': 'appointment_date',
      'ŸàŸÇÿ™ ÿßŸÑŸÖŸàÿπÿØ ŸÖÿ∑ŸÑŸàÿ®.': 'appointment_time'
    };

    errors.forEach(error => {
      const fieldName = fieldErrorMap[error];
      if (fieldName) {
        const field = document.getElementById(fieldName);
        if (field) {
          setFeedback(field, false, error);
        }
      }
    });
  }

  // Run on page load
  document.addEventListener('DOMContentLoaded', showFieldErrors);

  function validPhoneByCountry(){
    const cc = countryCode.value;
    const v = phoneField.value.trim();
    if (!v) return false;
    if (cc === '966') return /^05\d{8}$/.test(v);           // SA: 05xxxxxxxx
    return /^\d{8,12}$/.test(v);                            // others: 8-12 digits
  }


  function updateProgress(){
    // Count required completeness (handles radios/selects/inputs)
    const reqs = Array.from(form.querySelectorAll('[required]'));
    let done = 0;
    const seenRadio = new Set();
    reqs.forEach(f=>{
      if (f.type==='radio'){
        if (seenRadio.has(f.name)) return;
        seenRadio.add(f.name);
        if (form.querySelector(`input[name="${f.name}"]:checked`)) done++;
      } else if (f.tagName==='SELECT'){
        if (f.value) done++;
      } else {
        if (f.value.trim()) done++;
      }
    });
    const pct = Math.round((done / (new Set(reqs.map(f=>f.name||f.id)).size)) * 100);
    progressBar.style.width = Math.min(100, pct) + '%';
  }

  // Listeners: validation
  countryCode.addEventListener('change', ()=>{ phoneField.placeholder = (countryCode.value==='966'?'05xxxxxxxx':'ÿ±ŸÇŸÖ ÿßŸÑÿ¨ŸàÿßŸÑ'); if (phoneField.value) phoneField.dispatchEvent(new Event('input')); });
  phoneField.addEventListener('input', ()=>{
    // Auto-format SA to start with 05
    if (countryCode.value==='966'){
      let v = phoneField.value.replace(/\D/g,'');
      if (!v.startsWith('05')) v = '05' + v.replace(/^0+/, '');
      phoneField.value = v.slice(0,10);
    } else {
      phoneField.value = phoneField.value.replace(/\D/g,'').slice(0,12);
    }
    setFeedback(phoneField, validPhoneByCountry(), validPhoneByCountry() ? '' : (countryCode.value==='966'?'ÿ±ŸÇŸÖ ÿßŸÑÿ¨ŸàÿßŸÑ Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ®ÿØÿ£ ÿ®ŸÄ 05 ŸàŸäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ 10 ÿ£ÿ±ŸÇÿßŸÖ':'ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖŸãÿß ÿµÿ≠Ÿäÿ≠Ÿãÿß (8‚Äì12 ÿ±ŸÇŸÖ)'));
  });
  phoneField.addEventListener('blur', ()=>setFeedback(phoneField, validPhoneByCountry(), validPhoneByCountry()? '':''));
  emailField.addEventListener('input', ()=>{
    const ok = !emailField.value || /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailField.value);
    setFeedback(emailField, ok, ok?'':'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
  });
  // Plate number handling (ÿ≠ÿ±ŸàŸÅ ŸÖÿπÿ™ŸÖÿØÿ© + ÿ™ÿ∑ÿ®Ÿäÿπ + ŸÑÿßÿ™ŸäŸÜŸä)
  const ALLOWED_AR = ['ÿß','ÿ®','ÿ≠','ÿØ','ÿ±','ÿ≥','ÿµ','ÿ∑','ÿπ','ŸÇ','ŸÉ','ŸÑ','ŸÖ','ŸÜ','Ÿá','Ÿà','Ÿâ'];
  // ÿ®ÿπÿ∂ ÿßŸÑŸÜÿßÿ≥ ŸäŸÉÿ™ÿ® "Ÿä" ÿ®ÿØŸÑ "Ÿâ"ÿõ ŸÜÿπÿßŸÖŸÑŸáÿß ŸÉŸÄ "Ÿâ"
  const normalizeLetter = l => (l === 'Ÿä' ? 'Ÿâ' : l);
  
  // ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© -> ÿßŸÑŸÑÿßÿ™ŸäŸÜŸäÿ© ŸÉŸÖÿß ÿ™Ÿèÿ∑ÿ®ÿπ ÿπŸÑŸâ ÿßŸÑŸÑŸàÿ≠ÿ©
  // (A,B,J,D,R,S,X,T,E,G,K,L,Z,N,H,U,V)
  const LATIN_MAP = {
    'ÿß':'A','ÿ®':'B','ÿ≠':'J','ÿØ':'D','ÿ±':'R','ÿ≥':'S','ÿµ':'X','ÿ∑':'T',
    'ÿπ':'E','ŸÇ':'G','ŸÉ':'K','ŸÑ':'L','ŸÖ':'Z','ŸÜ':'N','Ÿá':'H','Ÿà':'U','Ÿâ':'V','Ÿä':'V'
  };
  
  // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© Ÿ†Ÿ°Ÿ¢Ÿ£Ÿ§Ÿ•Ÿ¶ŸßŸ®Ÿ© ÿ•ŸÑŸâ 0123456789
  const AR_NUM_MAP = {'Ÿ†':'0','Ÿ°':'1','Ÿ¢':'2','Ÿ£':'3','Ÿ§':'4','Ÿ•':'5','Ÿ¶':'6','Ÿß':'7','Ÿ®':'8','Ÿ©':'9'};
  const toENdigits = s => s.replace(/[Ÿ†-Ÿ©]/g, ch => AR_NUM_MAP[ch] || ch);
  
  // ÿ®ŸÜÿßÿ° ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿπÿ™ŸÖÿØÿ© ŸÅŸÇÿ∑
  [plateLetter1, plateLetter2, plateLetter3].forEach(sel => {
    const current = normalizeLetter(sel.value || '');
    sel.innerHTML = '<option value="">üî§ ÿßÿÆÿ™ÿ± ÿßŸÑÿ≠ÿ±ŸÅ</option>' +
      ALLOWED_AR.map(l => `<option value="${l}">${l}</option>`).join('');
    if (ALLOWED_AR.includes(current)) sel.value = current;
  });
  
  function updatePlateDisplay() {
    // ÿ™ŸÜÿ∏ŸäŸÅ Ÿàÿ•ÿ¨ÿ®ÿßÿ± ÿßŸÑŸÇŸäŸÖ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠
    const letter1 = normalizeLetter(plateLetter1.value || '');
    const letter2 = normalizeLetter(plateLetter2.value || '');
    const letter3 = normalizeLetter(plateLetter3.value || '');
  
    // numbers: ÿßÿ≥ŸÖÿ≠ ÿ®ÿ•ÿØÿÆÿßŸÑ 1‚Äì4 ÿ£ÿ±ŸÇÿßŸÖÿå ÿ≠ŸàŸëŸÑ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿ•ŸÑŸâ ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©ÿå Ÿàÿßÿ≠ÿµÿ± ÿßŸÑÿ∑ŸàŸÑ
    let numbersRaw = plateNumbers.value || '';
    numbersRaw = toENdigits(numbersRaw).replace(/\D/g, '').slice(0, 4);
    plateNumbers.value = numbersRaw; // ŸäÿπŸÉÿ≥ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ ŸÅŸä ÿßŸÑÿ≠ŸÇŸÑ
  
    // ÿ™ŸàŸÑŸäÿØ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÖÿÆŸÅŸäÿ©
    // ÿßŸÑÿ¥ŸÉŸÑ ÿßŸÑŸÖŸÇÿ±Ÿàÿ° (ŸÉŸÖÿß ÿ£ÿØÿÆŸÑŸá ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ)
    const fullPlate = `${letter1} ${letter2} ${letter3} ${numbersRaw}`.trim().replace(/\s+/g,' ');
    plateField.value = fullPlate;
  
    // ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿπŸäÿßÿ±Ÿäÿ©: 3 ÿ≠ÿ±ŸàŸÅ + 4 ÿ£ÿ±ŸÇÿßŸÖ padded
    const numbers4 = numbersRaw.padStart(4, '0');
    document.getElementById('plate_number_norm').value = `${letter1}${letter2}${letter3}${numbers4}`;
  
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ
    const lettersOK = [letter1,letter2,letter3].every(l => ALLOWED_AR.includes(l));
    const numsOK    = numbersRaw.length >= 1; // ŸÜŸÇÿ®ŸÑ 1‚Äì4 ÿ´ŸÖ ŸÜÿ∑ÿ®ÿπ ÿØÿßÿÆŸÑŸäŸãÿß ÿ•ŸÑŸâ 4
    const isValid   = lettersOK && numsOK;
  
    setFeedback(plateNumbers, isValid, isValid ? '' : 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± 3 ÿ≠ÿ±ŸàŸÅ ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿπÿ™ŸÖÿØÿ© Ÿàÿ•ÿØÿÆÿßŸÑ 1‚Äì4 ÿ£ÿ±ŸÇÿßŸÖ');
    return isValid;
  }
  
  [plateLetter1, plateLetter2, plateLetter3].forEach(sel => sel.addEventListener('change', updatePlateDisplay));
  plateNumbers.addEventListener('input', updatePlateDisplay);
  idField.addEventListener('input', ()=>{
    idField.value = idField.value.replace(/\D/g,'').slice(0,10);
    const ok = /^[0-9]{10}$/.test(idField.value);
    setFeedback(idField, ok, ok?'':'ÿ±ŸÇŸÖ ÿßŸÑŸáŸàŸäÿ©/ÿßŸÑÿ•ŸÇÿßŸÖÿ© Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 10 ÿ£ÿ±ŸÇÿßŸÖ');
  });
  yearField.addEventListener('change', ()=>{
    const y = parseInt(yearField.value || '0',10), cy = new Date().getFullYear();
    const ok = y >= 1990 && y <= cy;
    setFeedback(yearField, ok, ok?'':'ÿßŸÑÿ≥ŸÜÿ© ÿ®ŸäŸÜ 1990 Ÿà '+cy);
  });
  [vehicleType, branchSel, dateField, timeField, makeField, inspectionType].forEach(el=>{
    el.addEventListener('change', ()=>{ setFeedback(el, !!el.value, el.value?'':''); updateProgress(); });
    el.addEventListener('input',  ()=>{ setFeedback(el, !!el.value, el.value?'':''); updateProgress(); });
  });

  // Initialize
  (function init(){
    dateField.setAttribute('min', todayISO);
    updateProgress();

    // Restore local autosave
    try{
      const saved = JSON.parse(localStorage.getItem('bookingFormData') || '{}');
      Object.keys(saved).forEach(k=>{
        const field = form.querySelector(`[name="${k}"]`);
        if (field) field.value = saved[k];
      });
    }catch(_){}
  })();

  // Autosave
  form.addEventListener('input', e=>{
    if (!e.target.name) return;
    const data = JSON.parse(localStorage.getItem('bookingFormData') || '{}');
    data[e.target.name] = e.target.value;
    localStorage.setItem('bookingFormData', JSON.stringify(data));
  });

  // Submit
  const submitBtn = form.querySelector('button[type="submit"]');
  form.addEventListener('submit', function(e){
    // Basic required check
    let ok = true;
    const reqs = form.querySelectorAll('[required]');
    reqs.forEach(f=>{
      const valueOk = (f.tagName==='SELECT') ? !!f.value : !!f.value.trim();
      if (!valueOk){ ok=false; setFeedback(f,false,'Ÿáÿ∞ÿß ÿßŸÑÿ≠ŸÇŸÑ ŸÖÿ∑ŸÑŸàÿ®'); }
    });
    if (!validPhoneByCountry()){ ok=false; setFeedback(phoneField,false,'ÿ±ŸÇŸÖ ÿßŸÑÿ¨ŸàÿßŸÑ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠'); }
    if (emailField.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailField.value)){ ok=false; setFeedback(emailField,false,'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠'); }
    const plateValid = updatePlateDisplay(); // Ÿäÿπÿ™ŸÖÿØ ÿßŸÑŸÖŸÜÿ∑ŸÇ ÿßŸÑÿ¨ÿØŸäÿØ + ÿßŸÑÿ™ÿ∑ÿ®Ÿäÿπ
    if (!plateValid){ ok=false; /* ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸèÿØÿßÿ± ÿØÿßÿÆŸÑ updatePlateDisplay */ }
    if (!/^\d{10}$/.test(idField.value)){ ok=false; setFeedback(idField,false,'ÿ±ŸÇŸÖ ÿßŸÑŸáŸàŸäÿ©/ÿßŸÑÿ•ŸÇÿßŸÖÿ© ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠'); }

    if (!ok){
      e.preventDefault();
      const alert = document.createElement('div');
      alert.className = 'alert alert-error p-3 rounded';
      alert.innerHTML = '<strong>Ÿäÿ±ÿ¨Ÿâ ÿ™ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿ´ŸÖ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©.</strong>';
      form.prepend(alert);
      setTimeout(()=>alert.remove(), 4000);
      const firstErr = form.querySelector('.form-control.error, select.error');
      if (firstErr) firstErr.scrollIntoView({behavior:'smooth', block:'center'});
      return;
    }

    // Lock submit + clear autosave
    submitBtn.disabled = true;
    submitBtn.textContent = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©...';
    localStorage.removeItem('bookingFormData');
  });

  // Progress bar hook
  form.addEventListener('input', updateProgress);
  form.addEventListener('change', updateProgress);

  // ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿπÿßŸäŸÜÿ© ÿ®ÿ≠ŸÇŸàŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
  (function(){
    const l1 = document.getElementById('plate_letter1');
    const l2 = document.getElementById('plate_letter2');
    const l3 = document.getElementById('plate_letter3');
    const nums = document.getElementById('plate_numbers');
    
    const pvArNums = document.getElementById('pvArNums');
    const pvEnNums = document.getElementById('pvEnNums');
    const pvArLetters = document.getElementById('pvArLetters');
    const pvEnLetters = document.getElementById('pvEnLetters');
    
    if(!(l1 && l2 && l3 && nums && pvArNums && pvEnNums && pvArLetters && pvEnLetters)) return;
    
    // ÿ≠ÿ±ŸàŸÅ ŸÖÿπÿ™ŸÖÿØÿ© + ÿ™ÿ∑ÿ®Ÿäÿπ "Ÿä" -> "Ÿâ"
    const ALLOWED_AR = ['ÿß','ÿ®','ÿ≠','ÿØ','ÿ±','ÿ≥','ÿµ','ÿ∑','ÿπ','ŸÇ','ŸÉ','ŸÑ','ŸÖ','ŸÜ','Ÿá','Ÿà','Ÿâ'];
    const normY = ch => (ch === 'Ÿä' ? 'Ÿâ' : ch);
    
    // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ‚Üî ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©
    const AR2EN = {'Ÿ†':'0','Ÿ°':'1','Ÿ¢':'2','Ÿ£':'3','Ÿ§':'4','Ÿ•':'5','Ÿ¶':'6','Ÿß':'7','Ÿ®':'8','Ÿ©':'9'};
    const EN2AR = {'0':'Ÿ†','1':'Ÿ°','2':'Ÿ¢','3':'Ÿ£','4':'Ÿ§','5':'Ÿ•','6':'Ÿ¶','7':'Ÿß','8':'Ÿ®','9':'Ÿ©'};
    const toEN = s => (s||'').replace(/[Ÿ†-Ÿ©]/g, d => AR2EN[d]||d).replace(/\D/g,'').slice(0,4);
    const toAR = s => (s||'').replace(/[0-9]/g, d => EN2AR[d]||d);
    
    // ÿÆÿ±Ÿäÿ∑ÿ© ÿ™ÿ±ŸÖŸäÿ≤ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ (ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÑÿµŸàÿ± KSA ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©)
    const LATIN_MAP = {
      'ÿß':'A','ÿ®':'B','ÿ≠':'J','ÿØ':'D','ÿ±':'R','ÿ≥':'S','ÿµ':'X','ÿ∑':'T',
      'ÿπ':'E','ŸÇ':'G','ŸÉ':'K','ŸÑ':'L','ŸÖ':'Z','ŸÜ':'N','Ÿá':'H','Ÿà':'U','Ÿâ':'V','Ÿä':'V'
    };
    
    function render(){
      const L = [normY(l1.value||''), normY(l2.value||''), normY(l3.value||'')];
      const N = toEN(nums.value||'');
      
      // ÿßŸÑÿµŸÅ ÿßŸÑÿπŸÑŸàŸä (ÿπÿ±ÿ®Ÿä)
      const lettersAr = L.filter(Boolean).join(' ');
      pvArLetters.textContent = lettersAr || 'ÿß ÿ® ÿØ';
      pvArNums.textContent = toAR((N || '0000').padStart(4,'0'));
      
      // ÿßŸÑÿµŸÅ ÿßŸÑÿ≥ŸÅŸÑŸä (ŸÑÿßÿ™ŸäŸÜŸä) ‚Äî ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿ™Ÿèÿπÿ±ÿ∂ ÿ®ÿßŸÑÿπŸÉÿ≥ ŸÑÿ™ÿ∑ÿßÿ®ŸÇ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿµŸàÿ±ÿ©
      const lettersEn = L.map(ch => LATIN_MAP[ch]||'').reverse().filter(Boolean).join(' ');
      pvEnLetters.textContent = lettersEn || 'R X B';
      pvEnNums.textContent = (N || '0000').padStart(4,'0');
    }
    
    [l1,l2,l3].forEach(el => el.addEventListener('change', render));
    nums.addEventListener('input', render);
    render();
  })();

})();
</script>
</body>
</html>
